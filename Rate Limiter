import { redis } from "../config/redis";
import { env } from "../config/env";

export async function canSendEmail(sender: string) {
  const hourKey = `email:${sender}:${new Date().getHours()}`;
  const count = await redis.incr(hourKey);

  if (count === 1) {
    await redis.expire(hourKey, 3600);
  }

  return count <= env.MAX_EMAILS_PER_HOUR;
}
